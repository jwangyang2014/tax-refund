server:
  port: 8080
  shutdown: graceful
  forward-headers-strategy: framework

spring:
  lifecycle:
    timeout-per-shutdown-phase: 10s

  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
      database: 0

  datasource:
    url: ${POSTGRES_DB_URL:jdbc:postgresql://localhost:5432/taxrefund}
    username: ${POSTGRES_DB_USERNAME:postgres}
    password: ${POSTGRES_DB_PASSWORD:postgres}

  jpa:
    hibernate:
      ddl-auto: validate
    properties:
      hibernate:
        format_sql: true

  flyway:
    enabled: true

ml:
  baseUrl: ${ML_BASE_URL:http://localhost:8000}

# --- Actuator / Monitoring ---
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus,loggers,threaddump
  endpoint:
    health:
      probes:
        enabled: true
      show-details: when_authorized
  health:
    livenessState:
      enabled: true
    readinessState:
      enabled: true

  metrics:
    tags:
      service: ${APP_SERVICE_NAME:tax-refund-status}
      env: ${APP_ENV:local}
    distribution:
      percentiles-histogram:
        http.server.requests: true
      percentiles:
        http.server.requests: 0.5,0.9,0.95,0.99
    enable:
      jvm: true
      process: true
      system: true

  tracing:
    enabled: true
    sampling:
      probability: ${TRACING_SAMPLE_PROBABILITY:0.1}

# --- Logging levels (actual format is in log4j2-spring.xml) ---
logging:
  level:
    root: INFO
    org.springframework.security: INFO
    com.intuit.taxrefund: INFO

app:
  ratelimit:
    enabled: true
    refundLatest:
      capacity: 30
      refillPerMinute: 30
    assistantChat:
      capacity: 10
      refillPerMinute: 10

  security:
    jwt:
      secret: ${APP_SECURITY_JWT_SECRET:change-me-change-me-change-me-change-me-123456}
      issuer: ${APP_SECURITY_JWT_ISSUER:refund-status}
      accessTokenMinutes: 15
      refreshTokenDays: 14
    cookies:
      refreshName: refresh_token
      secure: false
      sameSite: Lax

ai:
  provider: ${AI_PROVIDER:mock}   # mock | openai
  openai:
    apiKey: ${OPENAI_API_KEY:}
    model: ${OPENAI_MODEL:gpt-4o-mini}

refund:
  polling:
    enabled: true
    fixedDelayMs: 10000